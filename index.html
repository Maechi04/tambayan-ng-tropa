<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tambayan ng Tropa</title>
<link rel="stylesheet" href="style.css">
<script type="module" src="https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js"></script>
<style>
/* Basic styling */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(to bottom, #0038a8, #fff, #ce1126);
    color: #333;
}
#loginModal {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    display:flex; justify-content:center; align-items:center;
    background: rgba(0,0,0,0.6);
    z-index:1000;
}
.modal-content {
    background:#fff;
    padding:20px;
    border-radius:10px;
    width:300px;
    position:relative;
}
.modal-content h2 {margin-top:0;}
.close-btn {
    position:absolute;
    top:10px; right:10px;
    cursor:pointer;
}
button {padding:10px 15px; margin-top:10px; cursor:pointer;}
#profilePage {display:none;}
#tabs {margin-top:20px;}
.tab {display:inline-block; margin-right:10px; cursor:pointer; padding:5px 10px; background:#fff; border-radius:5px;}
#wallPosts {margin-top:20px;}
</style>
</head>
<body>

<!-- Login/Register Modal -->
<div id="loginModal">
  <div class="modal-content">
    <span class="close-btn" id="closeModal">&times;</span>
    <h2>Tambayan ng Tropa</h2>
    <input type="text" id="nicknameInput" placeholder="Nickname"><br>
    <button id="googleLogin">Sign in with Google</button>
    <button id="adminLoginBtn">Admin Access</button>
  </div>
</div>

<!-- Profile Page -->
<div id="profilePage">
    <div id="header" style="display:flex; align-items:center;">
        <img id="profilePic" src="logo.png" alt="Profile" width="80" style="border-radius:50%; margin-right:15px;">
        <div>
            <h3 id="fullName">Full Name</h3>
            <p id="nickname">(Nickname)</p>
        </div>
        <button id="logoutBtn" style="margin-left:auto;">Logout</button>
    </div>

    <!-- Tabs -->
    <div id="tabs">
        <div class="tab" id="tabHome">Home</div>
        <div class="tab" id="tabFriends">Friends</div>
        <div class="tab" id="tabMessages">Messages</div>
        <div class="tab" id="tabNotifications">Notifications</div>
        <div class="tab" id="tabSettings">Settings</div>
    </div>

    <!-- Wall posts -->
    <div id="wallPosts"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase, ref, set, get, child, push } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAnJGJRlBw1spQ-1dY5L1miVyQ5ptnoNV4",
  authDomain: "tambayanngtropa-86436.firebaseapp.com",
  databaseURL: "https://tambayanngtropa-86436-default-rtdb.firebaseio.com",
  projectId: "tambayanngtropa-86436",
  storageBucket: "tambayanngtropa-86436.appspot.com",
  messagingSenderId: "1056515077642",
  appId: "1:1056515077642:web:6e4638e28f93dda68b11f3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();

// Elements
const loginModal = document.getElementById('loginModal');
const googleLogin = document.getElementById('googleLogin');
const adminLoginBtn = document.getElementById('adminLoginBtn');
const closeModal = document.getElementById('closeModal');
const profilePage = document.getElementById('profilePage');
const logoutBtn = document.getElementById('logoutBtn');
const fullNameEl = document.getElementById('fullName');
const nicknameEl = document.getElementById('nickname');
const profilePicEl = document.getElementById('profilePic');

// Close modal button
closeModal.onclick = ()=>{ loginModal.style.display='none'; }

// Admin login
adminLoginBtn.onclick = ()=>{
    let password = prompt("Enter Admin Password:");
    if(password==="Kenichi"){
        // Load admin user data from Realtime Database
        get(child(ref(db), 'users/admin')).then((snapshot)=>{
            if(snapshot.exists()){
                showProfile(snapshot.val());
            } else {
                alert("Admin user not found in DB!");
            }
        });
    } else {
        alert("Wrong password!");
    }
}

// Google login
googleLogin.onclick = ()=>{
    signInWithPopup(auth, provider).then((result)=>{
        const user = result.user;
        // Save user to Realtime Database if new
        set(ref(db, 'users/' + user.uid), {
            fullName: user.displayName,
            nickname: user.displayName,
            profilePic: user.photoURL,
            backgroundPic: "default-bg.png",
            music: "default-music.mp3",
            friends: {},
            friendRequests: {}
        });
        showProfile({
            fullName: user.displayName,
            nickname: user.displayName,
            profilePic: user.photoURL,
            backgroundPic: "default-bg.png",
            music: "default-music.mp3"
        });
    }).catch((err)=>{ console.log(err); alert("Login failed!") });
}

// Logout
logoutBtn.onclick = ()=>{
    signOut(auth).then(()=>{
        profilePage.style.display='none';
        loginModal.style.display='flex';
    });
}

// Show profile
function showProfile(data){
    loginModal.style.display='none';
    profilePage.style.display='block';
    fullNameEl.textContent = data.fullName;
    nicknameEl.textContent = `(${data.nickname})`;
    profilePicEl.src = data.profilePic;
    // Background music (auto-play)
    let audio = document.createElement('audio');
    audio.src = data.music;
    audio.autoplay = true;
    audio.loop = true;
    profilePage.appendChild(audio);
}

</script>
</body>
</html>
